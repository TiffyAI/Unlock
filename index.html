<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Unlock TiffyAI Wheel</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
  <script src="https://unpkg.com/web3modal@1.9.12/dist/index.js"></script>
  <style>
    body {
      background: radial-gradient(circle, #000, #111);
      color: #00ffcc;
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      padding: 50px;
    }
    img { width: 300px; margin-bottom: 30px; border-radius: 20px; box-shadow: 0 0 20px #00ffcc; }
    h1 { font-size: 28px; margin-bottom: 20px; }
    button {
      padding: 15px 30px;
      font-size: 18px;
      background: linear-gradient(45deg, #00ccff, #00ffcc);
      border: none;
      border-radius: 10px;
      font-weight: bold;
      margin: 10px;
      cursor: pointer;
      box-shadow: 0 0 12px #00ffcc;
    }
  </style>
</head>
<body>
  <h1>Unlock the Lucky Wheel</h1>
  <img src="Unlock.png" alt="Unlock" />
  <p>Win real TIFFY tokens on every spin!</p>
  <button onclick="checkClaim()">Unlock with Claim</button>
  <button onclick="payToUnlock()">Unlock with 0.5 TIFFY</button>

  <script>
    const contractAddress = "0x6df97Ec32401e23dEDB2E6cAF3035155890DC237";
    const receiverAddress = "0xed9b43bED20B063ae0966C0AEC446bc755fB84bA";
    const ABI = [
      { "inputs": [], "name": "decimals", "outputs": [{ "type": "uint8" }], "stateMutability": "view", "type": "function" },
      { "inputs": [{ "name": "", "type": "address" }], "name": "lastClaimed", "outputs": [{ "type": "uint256" }], "stateMutability": "view", "type": "function" },
      { "inputs": [{ "name": "recipient", "type": "address" }, { "name": "amount", "type": "uint256" }], "name": "transfer", "outputs": [{ "type": "bool" }], "stateMutability": "nonpayable", "type": "function" }
    ];
    const providerOptions = {
      walletconnect: {
        package: window.WalletConnectProvider.default,
        options: {
          rpc: { 97: "https://data-seed-prebsc-1-s1.binance.org:8545/" },
          chainId: 97
        }
      }
    };
    const web3Modal = new window.Web3Modal.default({ cacheProvider: false, providerOptions });

    let web3, contract, user;

    async function connect() {
      const instance = await web3Modal.connect();
      web3 = new Web3(instance);
      const accounts = await web3.eth.getAccounts();
      user = accounts[0];
      contract = new web3.eth.Contract(ABI, contractAddress);
    }

    async function checkClaim() {
      await connect();
      const lastClaimed = await contract.methods.lastClaimed(user).call();
      const now = Math.floor(Date.now() / 1000);
      if (now >= parseInt(lastClaimed) + 86400) {
        alert("Unlocked! Redirecting...");
        window.location.href = "wheel.html";
      } else {
        alert("Youâ€™ve already claimed today. Try the pay option.");
      }
    }

    async function payToUnlock() {
      await connect();
      const decimals = await contract.methods.decimals().call();
      const amount = (0.5 * (10 ** decimals)).toString();
      try {
        await contract.methods.transfer(receiverAddress, amount).send({ from: user });
        alert("Payment successful! Redirecting to wheel...");
        window.location.href = "wheel.html";
      } catch (err) {
        alert("Payment failed. " + err.message);
      }
    }
  </script>
</body>
</html>
